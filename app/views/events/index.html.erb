<% content_for :title, t('events.index.title') %>

<div class="min-h-screen relative overflow-hidden">
  <!-- Stunning Background -->
  <div class="absolute inset-0 bg-gradient-to-br from-primary-bg via-secondary-bg to-primary-bg"></div>
  
  <div class="max-w-7xl mx-auto px-6 py-16 relative z-10">
    <!-- Epic Header Section -->
    <div class="text-center mb-20 animate-slide-up">
      <div class="inline-flex items-center px-6 py-3 bg-glass-bg backdrop-filter backdrop-blur-lg border border-glass-border rounded-full mb-8">
        <span class="w-3 h-3 bg-vibrant-purple rounded-full mr-4 animate-pulse"></span>
        <span class="text-text-secondary text-sm font-medium font-display"><%= t('events.index.community_events') %></span>
      </div>
      
      <h1 class="font-display text-2xl lg:text-3xl font-black text-text-primary mb-8 leading-tight">
<%= t('events.index.amazing') %>
        <br>
        <span class="bg-gradient-to-r from-electric-blue via-vibrant-purple to-emerald-green bg-clip-text text-transparent"><%= t('events.index.events') %></span>
      </h1>
      
      <p class="font-content text-xl text-text-secondary max-w-4xl mx-auto mb-12 leading-relaxed">
        <%= t('events.index.description') %>
      </p>
      
      <% if user_signed_in? %>
        <div class="flex justify-center">
          <%= link_to new_event_path, class: "group relative overflow-hidden bg-gradient-to-r from-electric-blue to-vibrant-purple px-10 py-4 rounded-2xl font-bold text-text-primary shadow-2xl transform hover:scale-105 transition-all duration-500 inline-flex items-center" do %>
            <span class="relative z-10 flex items-center font-display text-lg">
              <%= t('events.index.create_new_event') %>
              <svg class="w-6 h-6 ml-3 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
            </span>
          <% end %>
        </div>
      <% end %>
    </div>
    
    <!-- Stunning Filter Section -->
    <div class="card-stunning p-8 mb-12">
      <%= form_with url: events_path, method: :get, local: true, class: "flex flex-col md:flex-row gap-6" do |form| %>
        <div class="flex-1">
          <%= form.select :filter, 
                         options_for_select([[t('events.index.all_events'), ""], [t('events.index.upcoming'), "upcoming"], [t('events.index.this_week'), "this_week"], [t('events.index.this_month'), "this_month"], [t('events.index.past'), "past"]], params[:filter]),
                         {}, 
                         { class: "w-full px-6 py-4 bg-glass-bg backdrop-filter backdrop-blur-lg border border-glass-border rounded-xl text-text-primary focus:outline-none focus:ring-2 focus:ring-electric-blue focus:border-electric-blue font-display" } %>
        </div>
        <div class="flex-1">
          <%= form.select :category, 
                         options_for_select([[t('common.all_categories'), ""]] + @categories.map { |cat| [cat.humanize, cat] }, params[:category]),
                         {}, 
                         { class: "w-full px-6 py-4 bg-glass-bg backdrop-filter backdrop-blur-lg border border-glass-border rounded-xl text-text-primary focus:outline-none focus:ring-2 focus:ring-electric-blue focus:border-electric-blue font-display" } %>
        </div>
        <div>
          <%= form.submit t('events.index.filter_events'), class: "group relative overflow-hidden bg-gradient-to-r from-vibrant-purple to-electric-blue px-8 py-4 rounded-xl font-bold text-text-primary shadow-xl transform hover:scale-105 transition-all duration-500 inline-flex items-center font-display" %>
        </div>
      <% end %>
    </div>
    
    <!-- Stunning Events Grid -->
    <% if @events.any? %>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
        <% @events.each do |event| %>
          <article class="card-stunning overflow-hidden group cursor-pointer" onclick="openEventModal(<%= event.id %>)">
            <% if event.images.attached? %>
              <div class="relative">
                <%= image_tag event.images.first, alt: event.title, class: "w-full h-20 object-cover group-hover:scale-110 transition-transform duration-500", loading: "lazy" %>
                <div class="absolute top-4 left-4 bg-glass-bg backdrop-filter backdrop-blur-lg border border-glass-border rounded-2xl p-3 text-center">
                  <div class="text-xs font-bold text-text-primary"><%= event.date.strftime("%b") %></div>
                  <div class="text-xl font-black text-text-primary"><%= event.date.strftime("%d") %></div>
                </div>
              </div>
            <% else %>
              <div class="h-24 bg-gradient-to-br from-electric-blue to-vibrant-purple flex items-center justify-center text-white relative overflow-hidden">
                <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.1"%3E%3Ccircle cx="30" cy="30" r="2"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')]"></div>
                <div class="text-center relative z-10">
                  <div class="text-4xl font-bold mb-3"></div>
                  <div class="text-xl font-bold"><%= event.date.strftime("%B %d") %></div>
                  <div class="text-sm opacity-90"><%= event.date.strftime("%Y") %></div>
                </div>
              </div>
            <% end %>
            
            <div class="p-8">
              <div class="flex items-center justify-between mb-4">
                <span class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-vibrant-purple/20 to-electric-blue/20 border border-vibrant-purple/30 rounded-full text-xs font-bold text-vibrant-purple">
                  <%= event.category.humanize %>
                </span>
                <div class="flex items-center text-text-secondary">
                  <span class="w-2 h-2 bg-emerald-green rounded-full mr-2 animate-pulse"></span>
                  <span class="font-medium"><%= event.date.strftime("%H:%M") %></span>
                </div>
              </div>
              
              <h3 class="font-display text-xl font-bold text-text-primary group-hover:text-electric-blue transition-colors mb-4 leading-tight">
                <%= event.title %>
              </h3>
              
              <p class="font-content text-text-secondary mb-6 leading-relaxed">
                <%= truncate(event.description, length: 100) %>
              </p>
              
              <div class="space-y-3 text-sm text-text-secondary mb-6">
                <div class="flex items-center">
                  <span class="text-lg mr-3"></span>
                  <span class="font-medium"><%= event.location || t('events.index.location_tbd') %></span>
                </div>
                <% if event.capacity.present? %>
                  <div class="flex items-center">
                    <span class="text-lg mr-3"></span>
                    <span class="font-medium"><%= event.rsvp_count || 0 %>/<%= event.capacity %> <%= t('events.index.attendees') %></span>
                  </div>
                <% end %>
              </div>
              
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 bg-gradient-to-br from-vibrant-purple to-electric-blue rounded-xl flex items-center justify-center">
                    <span class="text-white text-sm font-bold"><%= event.user.name.first.upcase %></span>
                  </div>
                  <span class="text-text-secondary font-medium">by <%= event.user.name %></span>
                </div>
                <div class="text-electric-blue font-bold text-sm group-hover:text-vibrant-purple transition-colors">
                  <%= t('events.index.view_details') %> â†’
                </div>
              </div>
            </div>
          </article>
          
          <!-- Event Modal -->
          <div id="eventModal<%= event.id %>" class="fixed inset-0 bg-black/80 backdrop-filter backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div class="card-stunning max-w-2xl w-full max-h-[90vh] overflow-y-auto">
              <div class="relative">
                <% if event.images.attached? %>
                  <%= image_tag event.images.first, alt: event.title, class: "w-full h-20 object-cover", loading: "lazy" %>
                <% else %>
                  <div class="h-24 bg-gradient-to-br from-electric-blue to-vibrant-purple flex items-center justify-center">
                    <span class="text-2xl"></span>
                  </div>
                <% end %>
                <button onclick="closeEventModal(<%= event.id %>)" class="absolute top-4 right-4 w-10 h-10 bg-black/50 backdrop-filter backdrop-blur-lg rounded-full flex items-center justify-center text-white hover:bg-black/70 transition-colors">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
              
              <div class="p-8">
                <div class="flex items-center justify-between mb-6">
                  <span class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-vibrant-purple/20 to-electric-blue/20 border border-vibrant-purple/30 rounded-full text-sm font-bold text-vibrant-purple">
                    <%= event.category.humanize %>
                  </span>
                  <div class="text-text-secondary">
                    <div class="font-display text-lg font-bold"><%= event.date.strftime("%B %d, %Y") %></div>
                    <div class="text-sm"><%= event.date.strftime("%H:%M") %></div>
                  </div>
                </div>
                
                <h2 class="font-display text-3xl font-black text-text-primary mb-6"><%= event.title %></h2>
                
                <div class="font-content text-text-secondary mb-8 leading-relaxed text-lg">
                  <%= simple_format(event.description) %>
                </div>
                
                <div class="space-y-4 mb-8">
                  <div class="flex items-center p-4 bg-surface-bg backdrop-filter backdrop-blur-sm border border-glass-border rounded-xl">
                    <span class="text-2xl mr-4"></span>
                    <div>
                      <div class="font-bold text-text-primary"><%= t('events.index.location') %></div>
                      <div class="text-text-secondary"><%= event.location || t('events.index.location_tbd') %></div>
                    </div>
                  </div>
                  <% if event.capacity.present? %>
                    <div class="flex items-center p-4 bg-surface-bg backdrop-filter backdrop-blur-sm border border-glass-border rounded-xl">
                      <span class="text-2xl mr-4"></span>
                      <div>
                        <div class="font-bold text-text-primary"><%= t('events.index.capacity') %></div>
                        <div class="text-text-secondary"><%= event.rsvp_count || 0 %>/<%= event.capacity %> <%= t('events.index.attendees') %></div>
                      </div>
                    </div>
                  <% end %>
                  <div class="flex items-center p-4 bg-surface-bg backdrop-filter backdrop-blur-sm border border-glass-border rounded-xl">
                    <span class="text-2xl mr-4"></span>
                    <div>
                      <div class="font-bold text-text-primary"><%= t('events.index.organizer') %></div>
                      <div class="text-text-secondary"><%= event.user.name %></div>
                    </div>
                  </div>
                </div>
                
                <div class="flex gap-4">
                  <%= link_to event_path(event), class: "flex-1 group relative overflow-hidden bg-gradient-to-r from-electric-blue to-vibrant-purple px-6 py-3 rounded-xl font-bold text-text-primary shadow-xl transform hover:scale-105 transition-all duration-500 text-center" do %>
                    <span class="relative z-10 font-display"><%= t('events.index.view_full_details') %></span>
                  <% end %>
                  <button onclick="closeEventModal(<%= event.id %>)" class="px-6 py-3 bg-glass-bg backdrop-filter backdrop-blur-lg border border-glass-border rounded-xl font-bold text-text-secondary hover:text-text-primary transition-colors font-display">
                    <%= t('common.close') %>
                  </button>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Pagination -->
    <div class="flex justify-center">
      <%= paginate @events if respond_to?(:paginate) %>
    </div>
  <% else %>
    <div class="card-stunning p-16 text-center">
      <div class="w-24 h-24 mx-auto mb-8 bg-gradient-to-br from-electric-blue/20 to-vibrant-purple/20 backdrop-filter backdrop-blur-sm border border-glass-border rounded-3xl flex items-center justify-center">
        <span class="text-2xl"></span>
      </div>
      <h3 class="font-display text-3xl font-bold text-text-primary mb-6"><%= t('events.index.no_events_found') %></h3>
      <p class="font-content text-text-secondary mb-8 text-lg max-w-md mx-auto leading-relaxed">
        <% if params[:filter].present? || params[:category].present? %>
          <%= t('events.index.try_adjusting_filters') %>
        <% else %>
          <%= t('events.index.be_first_to_organize') %>
        <% end %>
      </p>
      <% if user_signed_in? %>
        <%= link_to new_event_path, class: "group relative overflow-hidden bg-gradient-to-r from-electric-blue to-vibrant-purple px-8 py-4 rounded-2xl font-bold text-text-primary shadow-2xl transform hover:scale-105 transition-all duration-500 inline-flex items-center" do %>
          <span class="relative z-10 flex items-center font-display">
            <%= t('events.index.create_first_event') %>
            <svg class="w-5 h-5 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
          </span>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- JavaScript for Modal Functionality -->
  <script>
    function openEventModal(eventId) {
      document.getElementById('eventModal' + eventId).classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    function closeEventModal(eventId) {
      document.getElementById('eventModal' + eventId).classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
    
    // Close modal on backdrop click
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('backdrop-blur-sm')) {
        const modals = document.querySelectorAll('[id^="eventModal"]');
        modals.forEach(modal => {
          modal.classList.add('hidden');
        });
        document.body.style.overflow = 'auto';
      }
    });
  </script>
</div>